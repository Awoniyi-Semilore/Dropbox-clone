!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="bca65184-3396-32ba-acb1-a2c6b952e67d")}catch(e){}}();
define(["exports","./c_ttvc_util_index","./c_chat_chat_constants","./c_www_auth_csrf"],(function(e,t,s,o){"use strict";const n={idleTimeout:500,networkTimeout:6e4};class r{constructor(){this.pendingRequests=0,this.subscribers=new Set,this.didNetworkTimeOut=!1,this.next=e=>{this.subscribers.forEach((t=>t(e)))},this.startCleanupTimeout=()=>{this.abortCleanupTimeout();this.cleanupTimeout=window.setTimeout((()=>{this.didNetworkTimeOut=!0,this.pendingRequests=0,this.next("IDLE")}),n.networkTimeout)},this.abortCleanupTimeout=()=>{window.clearTimeout(this.cleanupTimeout),this.cleanupTimeout=void 0},this.increment=()=>{this.startCleanupTimeout(),0===this.pendingRequests&&this.next("BUSY"),this.pendingRequests+=1},this.decrement=()=>{this.abortCleanupTimeout(),1===this.pendingRequests?this.next("IDLE"):this.startCleanupTimeout(),this.pendingRequests=Math.max(this.pendingRequests-1,0)},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}}}}class i{constructor(){this.pendingResources=new Set,this.subscribers=new Set,this.didNetworkTimeOut=!1,this.next=e=>{this.subscribers.forEach((t=>t(e)))},this.startCleanupTimeout=()=>{this.abortCleanupTimeout();this.cleanupTimeout=window.setTimeout((()=>{this.didNetworkTimeOut=!0,this.pendingResources=new Set,this.next("IDLE")}),n.networkTimeout)},this.abortCleanupTimeout=()=>{window.clearTimeout(this.cleanupTimeout),this.cleanupTimeout=void 0},this.add=e=>{e instanceof HTMLImageElement&&!e.src||e instanceof HTMLImageElement&&e.complete||e instanceof HTMLLinkElement&&!e.href||e instanceof HTMLScriptElement&&!e.src||e instanceof HTMLIFrameElement&&!e.src||(this.startCleanupTimeout(),0===this.pendingResources.size&&this.next("BUSY"),this.pendingResources.add(e))},this.remove=e=>{this.abortCleanupTimeout(),this.pendingResources.delete(e),0===this.pendingResources.size?this.next("IDLE"):this.startCleanupTimeout()},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}},(null===window||void 0===window?void 0:window.MutationObserver)&&window.addEventListener("load",(()=>{new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{e instanceof HTMLScriptElement||e instanceof HTMLLinkElement||e instanceof HTMLImageElement||e instanceof HTMLIFrameElement?this.add(e):e.hasChildNodes()&&e instanceof HTMLElement&&e.querySelectorAll("img").forEach(this.add)}))}))})).observe(window.document.documentElement,{childList:!0,subtree:!0}),["load","error"].forEach((e=>{window.document.addEventListener(e,(e=>{(e.target instanceof HTMLScriptElement||e.target instanceof HTMLLinkElement||e.target instanceof HTMLImageElement||e.target instanceof HTMLIFrameElement)&&this.remove(e.target)}),{capture:!0})}))}))}}class a{constructor(){this.incrementAjaxCount=()=>{},this.decrementAjaxCount=()=>{},this.isIdle=()=>!0,this.didNetworkTimeOut=()=>!1,this.resetDidNetworkTimeOut=()=>{},this.subscribe=()=>()=>{}}}class d{constructor(){this.ajaxIdleObservable=new r,this.resourceLoadingIdleObservable=new i,this.subscribers=new Set,this.ajaxIdle=!0,this.scriptLoadingIdle=!0,this.handleUpdate=e=>t=>{const s=this.ajaxIdle&&this.scriptLoadingIdle;"AJAX"===e&&(this.ajaxIdle="IDLE"===t),"RESOURCE_LOADING"===e&&(this.scriptLoadingIdle="IDLE"===t);const o=this.ajaxIdle&&this.scriptLoadingIdle;s!==o&&this.next(o?"IDLE":"BUSY")},this.next=e=>{this.subscribers.forEach((t=>t(e)))},this.incrementAjaxCount=()=>this.ajaxIdleObservable.increment(),this.decrementAjaxCount=()=>this.ajaxIdleObservable.decrement(),this.isIdle=()=>this.ajaxIdle&&this.scriptLoadingIdle,this.didNetworkTimeOut=()=>this.ajaxIdleObservable.didNetworkTimeOut||this.resourceLoadingIdleObservable.didNetworkTimeOut,this.resetDidNetworkTimeOut=()=>{this.ajaxIdleObservable.didNetworkTimeOut=!1,this.resourceLoadingIdleObservable.didNetworkTimeOut=!1},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}},this.ajaxIdleObservable.subscribe(this.handleUpdate("AJAX")),this.resourceLoadingIdleObservable.subscribe(this.handleUpdate("RESOURCE_LOADING"))}}let p;const c=()=>s.isServerSide()||"undefined"==typeof window?new a:(p||(p=new d),p),u=c().incrementAjaxCount,l=c().decrementAjaxCount;function h(){if(!window.ensemble)return void 0!==s.getYapsProject()&&void 0!==s.getYapsDeployment()?`${s.getYapsProject()}:${s.getYapsDeployment()}`:void 0;const e=window.ensemble.getPageletInfoForExceptionReporting().filter((e=>void 0!==e.yaps_deployment&&void 0!==e.yaps_project));return 0!==e.length?e.sort(((e,t)=>e.pagelet_name<t.pagelet_name?-1:1)).map((e=>`${e.yaps_project}:${e.yaps_deployment}`)).join(";"):void 0}class m extends Error{constructor(e,t){super(t),this.name="FetchAbortError",this.response=e}}class f extends Error{constructor(e,t){super(t),this.name="FetchFailError",this.response=e}}class w extends Error{constructor(e,t){super(t),this.name="FetchResponseError",this.response=e}}function _(e){return"FetchResponseError"===e.name}var b,g,x;e.ApiV2HeaderNames=void 0,(b=e.ApiV2HeaderNames||(e.ApiV2HeaderNames={})).DropboxApiArg="Dropbox-API-Arg",b.DropboxApiSelectAdmin="Dropbox-API-Select-Admin",b.DropboxPathRoot="X-Dropbox-Path-Root",b.DropboxUid="X-Dropbox-Uid",b.DropboxTeamId="X-Dropbox-Teamid",b.DropboxTeamAuthorization="X-Dropbox-Team-Authorization",b.CsrfToken="X-CSRF-Token",b.DropboxForceQuic="X-Dropbox-Force-Quic",function(e){e[e.TeamAdminRole=0]="TeamAdminRole",e[e.MTARole=1]="MTARole",e[e.FederationAdminRole=2]="FederationAdminRole"}(g||(g={})),function(e){e[e.AdminAction=0]="AdminAction",e[e.AssumeAction=1]="AssumeAction",e[e.OnBehalfOfAction=2]="OnBehalfOfAction"}(x||(x={}));class E{static parse(e){const t=e[".tag"];return 2===Object.keys(e).length&&null!=e[t]?new T(t,e[t]):new A(t,e)}constructor(e,t,s){this.type=e,this.value=t,this.isScalar=s}}class T extends E{constructor(e,t=null){super(e,t,!0)}toJSON(){const e={".tag":this.type};return null!=this.value&&(e[this.type]=this.value),e}}class A extends E{constructor(e,t={}){super(e,t,!1)}toJSON(){return{".tag":this.type,...this.value||{}}}}class v extends Error{static parseResponse(e,t,s,o,n,r=null){var i,a;null==r&&(r=e in I?I[e]:e>=500?y:v);const d={raw:{status:e,responseBody:s},response:null,summary:null,error:{},headers:t,rpcPath:o};let p=s;try{const e=JSON.parse(s)||{};d.error=e.error,d.summary=e.error_summary||(null===(a=null===(i=e.error)||void 0===i?void 0:i.status)||void 0===a?void 0:a[".tag"])||"",e.user_message&&"string"==typeof e.user_message.text?p=e.user_message.text:"string"==typeof d.summary&&""!==d.summary&&(p=`error_summary: "${d.summary}"`)}catch(e){}d.response=p,o&&!p.startsWith("Error in call to API function")&&(p=`Error in call to API function ${o}: ${p}`);const c=Object.assign(new r(p),d);return n&&(c.stack=n),c}}class R extends v{}class y extends v{}const I={400:class extends v{},401:class extends v{},409:R,429:class extends v{}};function k(e){const t={};return e.forEach(((e,s)=>{t[s]=e})),t}class O{executeRpc(e,s,o,n,r,i){return new Promise(((a,d)=>{t.incrementAjaxCount(),u();const p=()=>{t.decrementAjaxCount(),l()};return fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{...s,"Content-Type":n},body:o,signal:r}).then((e=>e.text().then((t=>({response:e,responseText:t}))))).then((({response:e,responseText:t})=>{if(e.ok)return{response:e,responseText:t};throw new w(e,t)})).then((({response:e,responseText:t})=>(p(),a({headers:k(e.headers),result:JSON.parse(t)})))).catch((t=>(p(),_(t)?d(v.parseResponse(t.response.status,k(t.response.headers),t.message,e.getPath(),i)):d(v.parseResponse(0,{},"Fetch network failure - message aborted or user offline",e.getPath(),i)))))}))}executeBinaryRpc(e,s,o,n,r){return new Promise(((i,a)=>(t.incrementAjaxCount(),u(),fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{...s,"Content-Type":n},body:o,signal:r}).then((e=>e.ok?e.arrayBuffer().then((t=>({response:e,responseData:t}))):e.text().then((t=>{throw new w(e,t)})))).then((({response:e,responseData:t})=>i({headers:k(e.headers),result:t}))).catch((t=>_(t)?a(v.parseResponse(t.response.status,k(t.response.headers),t.message,e.getPath())):a(v.parseResponse(0,{},"Fetch network failure - message aborted or user offline",e.getPath())))).finally((()=>{t.decrementAjaxCount(),l()})))))}}class H extends O{}class C{constructor(e,t=!1){this.uploadEndpoints=new Set(["backups/upload_session/append","files/alpha/upload","files/paper/create","files/paper/update","files/upload","files/upload_v2","files/upload_session/append_v2","files/upload_session/append_batch","files/upload_session/finish","files/upload_session/finish_v2","files/upload_session/start","paper/cloud_docs/update","paper/desktop/spaces/upload_log","paper/desktop/upload_log","paper/docs/create","paper/docs/update","support_attachments/upload","hellosign/self_sign","hellosign/send_signature_request","ungated_file_conv_block/convert_to_pdf"]),this.downloadEndpoints=new Set(["backups/download","backups/download_zip","files/download","files/download_zip","files/export","files/get_preview","files/get_thumbnail_v2","paper/docs/download","sharing/get_shared_link_file","sharing/export_shared_link","hellosign/convert_to_pdf_download","privacy_request/fs_user_get_export"]),this.supportedUploadEndpoints=new Set(["backups/upload_session/append","files/paper/create","files/paper/update","files/upload","files/upload_v2","files/upload_session/append_v2","files/upload_session/append_batch","files/upload_session/finish","files/upload_session/finish_v2","files/upload_session/start","paper/cloud_docs/update","paper/desktop/spaces/upload_log","paper/desktop/upload_log","paper/docs/create","paper/docs/update","support_attachments/upload","hellosign/self_sign","hellosign/send_signature_request","ungated_file_conv_block/convert_to_pdf"]),this.supportedDownloadEndpoints=new Set(["backups/download","backups/download_zip","files/download","files/get_thumbnail_v2","sharing/get_shared_link_file","sharing/export_shared_link","hellosign/convert_to_pdf_download","privacy_request/fs_user_get_export"]),this.transport=e||new H,this.ns=S.bind(this),this.skipCsrf=t}_upload(e,t,s,o){return this._uploadWithResponseHeaders(e,t,s,o).then((e=>e.result))}_uploadWithResponseHeaders(t,o,n,r){if(!this.uploadEndpoints.has(t))throw new Error(t+" does not use the content-upload endpoint format");if(!this.supportedUploadEndpoints.has(t))throw new Error(t+" is not in the supported list of content-upload endpoints");const i={...this.csrfHeaders(),[e.ApiV2HeaderNames.DropboxApiArg]:this.http_header_safe_json(o),...this._headers(r)};if(Boolean(s.isHTTP3SupportEnabled())&&(i[e.ApiV2HeaderNames.DropboxForceQuic]="true"),"string"==typeof n||void 0===n)return this.executeRpc(t,i,n||"","application/octet-stream",r.signal);{const e=new Blob([n],{type:"application/octet-stream"});return this.executeRpc(t,i,e,"application/octet-stream",r.signal)}}_download(e,t,s,o){return this._downloadWithResponseHeaders(e,t,s,o).then((e=>e.result))}_downloadWithResponseHeaders(t,o,n,r){if(void 0===r||!r.hasOwnProperty("dangerouslyFetchUserContent")||!r.dangerouslyFetchUserContent)throw new Error("download requires explicit acknowledgement of the risk");if(!this.downloadEndpoints.has(t))throw new Error(t+" does not use the content-download endpoint format");if(!this.supportedDownloadEndpoints.has(t))throw new Error(t+" is not in the supported list of content-download endpoints");const i={...this.csrfHeaders(),[e.ApiV2HeaderNames.DropboxApiArg]:this.http_header_safe_json(o),...this._headers(n)};return Boolean(s.isHTTP3SupportEnabled())&&(i[e.ApiV2HeaderNames.DropboxForceQuic]="true"),this.executeBinaryRpc(t,i,"","application/octet-stream",n.signal)}_rpc(e,t,s,o){return this._rpcWithResponseHeaders(e,t,s,o).then((e=>e.result))}_rpcWithResponseHeaders(t,o,n,r){const i={...this.csrfHeaders(),...this._headers(n)};if(Boolean(s.isHTTP3SupportEnabled())&&(i[e.ApiV2HeaderNames.DropboxForceQuic]="true"),this.downloadEndpoints.has(t))throw new Error(t+' does not use the rpc endpoint format. Use "download" instead');if(this.uploadEndpoints.has(t))throw new Error(t+' does not use the rpc endpoint format. Use "upload" instead');const a=JSON.stringify(o||null);return this.executeRpc(t,i,a,"application/json",n.signal,r)}csrfHeaders(){return this.skipCsrf||s.getPageAuthChannel()===s.AuthChannel.OAUTH_TOKEN?{}:{[e.ApiV2HeaderNames.CsrfToken]:o.mustReadCsrfToken()}}async executeRpc(e,t,s,n,r,i){const a="client-web.dropbox.com"===window.location.hostname?"client-web.dropbox.com":"www.dropbox.com";const d=h();d&&(t["x-dropbox-client-yaps-attribution"]=d);const p=new o.URI({scheme:"https",authority:a,path:"/2/"+e,query:undefined});return await this.transport.executeRpc(p,t,s,n,r,i)}async executeBinaryRpc(e,t,s,n,r){const i="client-web.dropbox.com"===window.location.hostname?"client-web.dropbox.com":"www.dropbox.com";const a=new o.URI({scheme:"https",authority:i,path:"/2/"+e,query:undefined});return await this.transport.executeBinaryRpc(a,t,s,n,r)}http_header_safe_json(e){return JSON.stringify(e).replace(/[\u007f-\uffff]/g,(function(e){return"\\u"+("000"+e.charCodeAt(0).toString(16)).slice(-4)}))}}function S(e){const t=this,s=(new Error).stack;return{rpc:function(o,n,r){return t._rpc(e+"/"+o,n,r,s)},rpcWithResponseHeaders:function(o,n,r){return t._rpcWithResponseHeaders(e+"/"+o,n,r,s)},upload:function(s,o,n,r){return t._upload(e+"/"+s,o,n,r)},uploadWithResponseHeaders:function(s,o,n,r){return t._uploadWithResponseHeaders(e+"/"+s,o,n,r)},download:function(s,o,n,r){return t._download(e+"/"+s,o,n,r)},downloadWithResponseHeaders:function(s,o,n,r){return t._downloadWithResponseHeaders(e+"/"+s,o,n,r)}}}var L=Object.freeze({__proto__:null,UnAuthedApiV2Client:class extends C{constructor(e){super(e,!0)}_headers(e){return{...e.headers}}}});e.ApiError=v,e.ApiV2ClientBase=C,e.AppError=R,e.CONFIG=n,e.FetchAbortError=m,e.FetchAsyncTransport=O,e.FetchFailError=f,e.FetchResponseError=w,e.Union=E,e.UnionScalar=T,e.catchApiError=function(e){return function(t){if(function(e){return e instanceof v}(t))return e(t);throw t}},e.decrementAjaxCount=l,e.errorIsFetchAbortError=function(e){return"FetchAbortError"===e.name},e.errorIsFetchFailError=function(e){return"FetchFailError"===e.name},e.errorIsFetchResponseError=_,e.filterApiError=e=>e instanceof v?e:void 0,e.getAttributionHeader=h,e.getNetworkIdleObservable=c,e.incrementAjaxCount=u,e.isAppError=function(e){return e instanceof R},e.unauthed_client_esnext=L}));
//# sourceMappingURL=c_api_v2_unauthed_client.js-vflWsVdZz.map

//# debugId=bca65184-3396-32ba-acb1-a2c6b952e67d