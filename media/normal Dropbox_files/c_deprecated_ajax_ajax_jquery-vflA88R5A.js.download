!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9ba1d3f1-5387-38e4-9859-cebe730bd645")}catch(e){}}();
define(["exports","./c_ttvc_util_index","./c_api_v2_unauthed_client","./e_warp_warp_page_edison","./c_chat_chat_constants","./c_www_auth_csrf","./c_core_notify","./c_core_i18n"],(function(t,e,s,r,n,o,i,a){"use strict";const c=t=>({response:void 0,responseText:"",status:0,statusText:"",getResponseHeader:function(t){return this.response?this.response.headers.get(t):null},readyState:XMLHttpRequest.UNSENT,abortController:t,thens:[],catches:[],abort:()=>t&&t.abort(),then:function(t,e){return this.thens.push(t),this.catches.push(e),this},catch:function(t){return this.catches.push(t),this},resolve:function(t){this.thens.forEach((e=>{e&&e(t)}))},reject:function(t){this.catches.forEach((e=>{e&&e(t)}))}});function u(t){return t}const h="err:",d="htmlerr:",l="async_task_err:",_="done:";function p(t,n){null==t&&(t={}),null==n&&(n=[]);const o=new b(t),i=f(o,n),a=i.options().type||"POST",u=i.data(),d=i.dataType(),l=new AbortController,_=c(l);e.incrementAjaxCount(),s.incrementAjaxCount();const p=i.headers().then((e=>{var s;let n=String(i.url());e.has("Content-Type")||e.append("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");const o={method:a,mode:"cors",credentials:t.credentials||"include",headers:e,signal:l.signal};if("POST"===a){const t=null===(s=e.get("Content-Type"))||void 0===s?void 0:s.includes("application/x-www-form-urlencoded");o.body=t?r.jqParam(u,!0):u}else n=r.mergeQueryParams(n,u);return fetch(n,o)})).then((t=>t.text().then((e=>({response:t,responseText:e}))))).then((({response:t,responseText:e})=>{const{ok:s,status:r,statusText:n}=t;if(_.response=t,_.readyState=XMLHttpRequest.DONE,_.responseText=e,_.status=r,_.statusText=n,s)if("abort"===n)i.error(_,"aborted","abort"),i.complete(_,"aborted");else if("failed"===n)i.error(_,"failed",n),i.complete(_,"failed");else if("json"===d)try{const t=e.startsWith(h)?e:JSON.parse(e);i.success(t,"success",_),i.complete(_,"success"),_.resolve(t)}catch(t){i.error(_,"parsererror",t.message),i.complete(_,"parsererror")}else i.success(e,"success",_),i.complete(_,"success"),_.resolve(e);else{_.status=t.status;const s=500===t.status?"":e;_.responseText=s,i.error(_,"error",s||_.statusText),i.complete(_,"error"),_.reject(_.responseText)}return t})).catch((t=>{"AbortError"===t.name?(_.statusText="abort",i.error(_,"aborted","abort"),i.complete(_,"aborted")):(i.error(_,"error",t.message),i.complete(_,"error")),_.reject(t)})).finally((()=>{e.decrementAjaxCount(),s.decrementAjaxCount()}));return i.request(p),_}function x(t){return t.type===m.CHAINED}const f=function(t,e){const s=[t];for(const t of Array.from(e.slice(0).reverse()))s.push(new t);let r=t;for(const t of s)r&&x(t)&&(t.next=r),r=t;return r};var m;!function(t){t.BASE="base",t.CHAINED="chained"}(m||(m={}));class b{constructor(t){this.type=m.BASE;const e=t||{},s=new Headers,r=e.headers||{};Object.keys(r).forEach((t=>{const e=r[t]||"";s.append(t,String(e))})),this.options=()=>e,this.url=()=>String(e.url||""),this.data=()=>e.data||{},this.dataType=()=>e.dataType||"text",this.headers=()=>Promise.resolve(s),this.success=e.success||u,this.error=e.error||u,this.complete=e.complete||u,this.request=u}}class g{constructor(){this.type=m.CHAINED}options(){return this.next.options()}url(){return this.next.url()}contentType(){return this.next.contentType()}data(){return this.next.data()}dataType(){return this.next.dataType()}async headers(){return this.next.headers()}success(t,e,s){this.next.success(t,e,s)}error(t,e,s){this.next.error(t,e,s)}complete(t,e){this.next.complete(t,e)}request(t){this.next.request(t)}}class w extends g{constructor(){super(...arguments),this.SUPPORTED_TLDS=["dropbox.com"]}static initClass(){}data(){if(this.options().skipInjectCsrf)return this.next.data();o.assert(this._is_db_domain(),"injecting CSRF token into request to non-dropbox domain");const t={is_xhr:!0};return"GET"!==(this.options().type||"POST").toUpperCase()&&(t.t=o.readCsrfToken()),{...t,...this.next.data()}}_is_db_domain(){const t=o.URI.parse(String(this.url())).getAuthority();if(!t)return!0;const e=t.split(".");return this.SUPPORTED_TLDS.reduce((function(t,s){const r=s.split("."),n=e.slice(-1*r.length).join(".");return t||s===n}),!1)}}w.initClass();class y extends g{data(){const t=this.next.data(),e=this.options();return e.subject_user&&!t._subject_uid&&(t._subject_uid=String(e.subject_user)),t}async headers(){const t=await this.next.headers(),e=this.options();return e.subject_user&&t.set("X-DROPBOX-UID",String(e.subject_user)),t}}class T extends g{async headers(){var t,e,s,o;const[i,a]=await Promise.all([this.next.headers(),r.fetchViewer()]),c=this.options().teamAuthParams||{},u=c.team_id||a.team_id;if(u){const{subject_user:s}=this.options(),r=null===(t=this.next.data())||void 0===t?void 0:t._subject_uid,n=("number"==typeof s?s:null==s?void 0:s.id)||("string"==typeof r?parseInt(r,10):r);n&&n===(null===(e=a.work_user)||void 0===e?void 0:e.id)&&i.set("X-Dropbox-Teamid",String(u))}const h=c.auth_role||(null===(s=n.getAuthRequestInfo())||void 0===s?void 0:s.authRole),d=c.auth_action_type||(null===(o=n.getAuthRequestInfo())||void 0===o?void 0:o.authActionType);return(h||d)&&i.set("X-Dropbox-Team-Authorization",JSON.stringify({auth_role:String(h),auth_action_type:String(d)})),i}}const v=[class extends g{constructor(){super(),this.browser_unload_handler=this.browser_unload_handler.bind(this),this.is_browser_unloading=!1}browser_unload_handler(){this.is_browser_unloading=!0}request(t){return window.addEventListener("beforeunload",this.browser_unload_handler),this.next.request(t)}error(t,e,s){return"error"===e&&this.is_browser_unloading?this.next.error(t,"aborted","unload"):this.next.error(t,e,s)}complete(t,e){return window.removeEventListener("beforeunload",this.browser_unload_handler),this.next.complete(t,e)}}],j=[y,T,w,class extends g{error(t,e,s){if(403===t.status){const t=r.SessionStorage.get("reload-timestamp"),e=(new Date).getTime();(!t||e-t>3e4)&&(r.SessionStorage.set("reload-timestamp",e),window.location.reload())}return this.next.error(t,e,s)}}],S=[class extends g{constructor(){super(),this._clear_working_msg=this._clear_working_msg.bind(this)}request(t){let e=!1;t.catch((()=>{})).then((()=>{e=!0}));const s=()=>{e||(this._should_show_working_msg()?(this._show_working_msg(),t.catch((()=>{})).then((()=>{this._clear_working_msg()}))):setTimeout(s,100))};return setTimeout(s,4e3),this.next.request(t)}_should_show_working_msg(){const t=i.Notify.current();return null!=t&&Date.now()>t.shownAtMs+t.durationMs/2}_show_working_msg(){return this.notificationId=i.Notify.success(a.intl.formatMessage({id:"8jNAni",defaultMessage:"Still working..."})),this.notificationId}_clear_working_msg(){const t=i.Notify.current();if(t&&t.timeoutId===this.notificationId)return i.Notify.clear()}}],A=[class extends g{error(t,e,s){return this._notify_dev(t,e,s),this.next.error(t,e,s)}_notify_dev(t,e,s){t.getResponseHeader("X-Debug-Url")}},class extends g{async headers(){const t=await this.next.headers(),e=s.getAttributionHeader();return e&&t.append("x-dropbox-client-yaps-attribution",e),t}},class extends g{data(){return this.next.data()}async headers(){const t=await this.next.headers();return this.options().type,t}},class extends g{data(){const t=this.next.data(),e={};n.getPublicModeOverride()&&(e.public_mode_override="1");const s=n.getCountryOverride();return s&&(e.country_override=s),{...e,...t}}}],k=[class extends g{constructor(){super(),this._watch=this._watch.bind(this)}data(){const t=this.next.data();this.uid=t._subject_uid?String(t._subject_uid):"";const{subject_user:e}=this.options();return!this.uid&&e&&(this.uid=String(e)),t}success(t,e,s){return this._is_async_job_response(s.responseText)?(this.job_id=s.responseText.split(":")[1],this._interval=1e3,this._failures=0,this._watch_count=0,this._watch_id=setInterval(this._watch,this._interval)):this.next.success(t,e,s)}complete(t,e){if(!this._is_async_job_response(t.responseText))return this.next.complete(t,e)}_is_async_job_response(t){if(!t||0!==t.indexOf("async_task_started:"))return!1;return t.split(":")[1].match(/^[A-Za-z0-9_\-=]*$/)}_watch(){return r.Job.peek(this.job_id)?this._stop():(this._watch_count++,this._watch_count%10==0&&(clearInterval(this._watch_id),this._interval=Math.min(Math.floor(1.5*this._interval),3e4),this._watch_id=setInterval(this._watch,this._interval)),this._show_progress_modal(),this._fetch_progress())}_stop(){clearInterval(this._watch_id),r.ModalProgress.hide()}_show_progress_modal(){if(this._modal_shown)return;this._modal_shown=!0;const{progress_text:t}=this.options();t&&r.ModalProgress.show(t)}_fetch_progress(){const t={};return this.uid&&(t._subject_uid=this.uid),O({url:`/async_task_status/${this.job_id}`,data:t,dataType:"text",success:(t,e,s)=>{let n=s.responseText;if(0===n.indexOf(_))return r.Job.handled(this.job_id),this._stop(),n=n.substr(5),s.responseText=n,this.next.success(t,e,s),this.next.complete(s,e);if(0===n.indexOf(h)){r.Job.handled(this.job_id),this._stop();const t=n.substr(h.length);return i.Notify.error(t),this.next.error(s,e,t),this.next.complete(s,e)}if(0===n.indexOf(l)){r.Job.handled(this.job_id),this._stop();const t=n.substr(15),{skipNotifyError:o}=this.options();return o||i.Notify.error(new i.HTML(t)),this.next.error(s,e,t),this.next.complete(s,e)}r.ModalProgress.update(n)},error:(t,e,s)=>{if(this._failures++,!(this._failures<3))return this._stop(),this.next.error(t,e,s),this.next.complete(t,e)}})}}],q=[].concat(v,S,class extends g{success(t,e,s){let r;if(!s.responseText.length)return this.next.error(s,e,"AJAX Response was empty.");const n=this.options();let o=!0,a=!1;if(0===s.responseText.indexOf(h))r=s.responseText.substr(h.length),["{","["].includes(r[0])&&(o=!1);else{if(0!==s.responseText.indexOf(d))return this.next.success(t,e,s);r=s.responseText.substr(8),a=!0}const c=this.next.error(s,e,r);if(o&&!n.skipNotifyError){let t=r;a&&(t=new i.HTML(r)),i.Notify.error(t)}return c}error(t,e,s){const r=this.options();return"aborted"===e||r.skipNotifyError||i.Notify.error(a.intl.formatMessage({id:"A1ZtqA",defaultMessage:"There was a problem completing this request."})),this.next.error(t,e,s)}},A,j,k);const E=[].concat(v,S,class extends g{success(t,e,s){if(!this.options().skipErrorHandling){if(!s.responseText.length)return this.next.error(s,e,"AJAX Form response was empty.");if(0===s.responseText.indexOf(h)){const t=s.responseText.substr(h.length);return this.next.error(s,e,t)}}return this.next.success(t,e,s)}},A,j,k);const N=[].concat(v,A,[y,T,w]);function O(t){return null==t&&(t={}),p(t,N)}t.BackgroundRequest=function(t){return null==t&&(t={}),p(t,[].concat(v,A,j))},t.FormWebRequest=function(t){return null==t&&(t={}),p(t,E)},t.SilentBackgroundRequest=O,t.WebRequest=function(t){return null==t&&(t={}),p(t,q)},t.getFakeJQXHR=c}));
//# sourceMappingURL=c_deprecated_ajax_ajax_jquery.js-vflJcRAgg.map

//# debugId=9ba1d3f1-5387-38e4-9859-cebe730bd645