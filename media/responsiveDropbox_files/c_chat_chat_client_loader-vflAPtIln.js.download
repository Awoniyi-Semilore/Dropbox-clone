!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="d204fb80-83de-3a0b-a4d7-fa16f2380483")}catch(e){}}();
define(["require","exports","./e_warp_warp_page_edison","react","./c_core_i18n","./e_core_exception","./c_src_sink_index","./c_init_data_debug_panel","./c_chat_chat_constants","./c_lodash-es_lodash","metaserver/static/js/langpack","./c_init_data_edison","./c_www_auth_csrf","./c_core_notify","react-dom","./c_bem","./e_data_modules_stormcrow","./e_edison","./c_ttvc_util_index","./c_api_v2_unauthed_client","./c_redux_namespaces"],(function(e,t,n,i,o,a,s,c,r,h,_,l,d,u,C,p,g,m,w,A,f){"use strict";function P(e){return e.ns("megaphone_chat")}class M{constructor(){this.loadClient=(e,t)=>{if(e){const n=t.chatStoneToProtoModule.chatStoneToProto(e);t.chatClientModule.ChatClientSingleton.setupChatEnvironment(n)}},this.getBestChatCampaignAndLoadChatClient=(e,t,n)=>{const i={url:e};if(n){return P(new t.defaultUserClientModule.DefaultUserApiV2Client(n)).rpc("get_best_chat_campaigns",i,{}).then((e=>this.loadClient(e.props,t)))}return P(new t.noAuthClientModule.NoAuthApiV2Client).rpc("get_best_chat_campaigns",i,{}).then((e=>this.loadClient(e.props,t)))},this.getChatCampaignByIdAndLoadClient=(e,t,n,i)=>{const o={url:e,campaign_id:t,locale:window.navigator.language?window.navigator.language:window.navigator.browserLanguage};if(i){return P(new n.defaultUserClientModule.DefaultUserApiV2Client(i)).rpc("get_chat_campaign_by_id",o,{}).then((e=>this.loadClient(e.props,n)))}return P(new n.noAuthClientModule.NoAuthApiV2Client).rpc("get_chat_campaign_by_id",o,{}).then((e=>this.loadClient(e.props,n)))},this.resumeOrGetBestChatCampaignAndLoadClient=(e,t,n,i)=>e?Promise.resolve(this.loadClient(e,t)):this.getBestChatCampaignAndLoadChatClient(n,t,i),this.getResumedChatCampaignAndLoadClient=(e,t,n,i,o)=>{const a={url:e,legacy_persistence_cookie:t||"",chat_persistence_cookie:n||""};if(o){return P(new i.defaultUserClientModule.DefaultUserApiV2Client(o)).rpc("get_resumed_chat_campaign",a,{}).then((t=>this.resumeOrGetBestChatCampaignAndLoadClient(t.props,i,e,o)))}return P(new i.noAuthClientModule.NoAuthApiV2Client).rpc("get_resumed_chat_campaign",a,{}).then((t=>this.resumeOrGetBestChatCampaignAndLoadClient(t.props,i,e,o)))},this.importDependencies=()=>Promise.all([new Promise((function(t,n){e(["./e_warp_warp_page_edison"],t,n)})).then((function(e){return e.default_user_client_esnext})),new Promise((function(t,n){e(["./e_warp_warp_page_edison"],t,n)})).then((function(e){return e.noauth_client_esnext})),new Promise((function(t,n){e(["./c_chat_chat_stone_to_proto"],t,n)})),new Promise((function(t,n){e(["./c_chat_chat_client"],t,n)})).then((function(e){return e.chat_client_esnext})),new Promise((function(t,n){e(["./c_www_auth_csrf"],t,n)})).then((function(e){return e.cookies_esnext})),new Promise((function(t,n){e(["./c_chat_chat_constants"],t,n)})).then((function(e){return e.chat_constants_esnext}))]),this.getCookies=(e,t)=>{const{Cookies:n}=e,{SNAPENGAGE_CHAT_VISIBLE_COOKIE:i,CHAT_CAMPAIGN_VISIBLE_COOKIE:o}=t;return{legacy_persistence_cookie:n.read(i),chat_persistence_cookie:n.read(o)}},this.getCampaignFromChatServiceWithDependencies=([e,t,n,i,o,a],s,c)=>{const r={defaultUserClientModule:e,noAuthClientModule:t,chatStoneToProtoModule:n,chatClientModule:i,cookiesModule:o,chatConstantsModule:a},h=this.getCookies(o,a);return h.legacy_persistence_cookie||h.chat_persistence_cookie?this.getResumedChatCampaignAndLoadClient(s,h.legacy_persistence_cookie,h.chat_persistence_cookie,r,c):this.getBestChatCampaignAndLoadChatClient(s,r,c)},this.getChatCampaignIDFromChatServiceWithDependencies=([e,t,n,i,o,a],s,c,r)=>{const h={defaultUserClientModule:e,noAuthClientModule:t,chatStoneToProtoModule:n,chatClientModule:i,cookiesModule:o,chatConstantsModule:a},_=this.getCookies(o,a);return _.legacy_persistence_cookie||_.chat_persistence_cookie?this.getResumedChatCampaignAndLoadClient(s,_.legacy_persistence_cookie,_.chat_persistence_cookie,h,r):this.getChatCampaignByIdAndLoadClient(s,c,h,r)},this.loadChatClientWithBestCampaign=(e,t,i)=>{if(this.loadPromise)return this.loadPromise;const o=i?Promise.resolve():n.waitForTTI({timeoutMS:5e3});return this.loadPromise=o.then((()=>this.importDependencies())).then((n=>this.getCampaignFromChatServiceWithDependencies(n,e,t))),this.loadPromise},this.loadCampaignByID=(e,t,n)=>(this.loadPromise||(this.loadPromise=this.importDependencies().then((i=>this.getChatCampaignIDFromChatServiceWithDependencies(i,e,t,n)))),this.loadPromise)}}const k=new M;t.ChatClientLoaderSingleton=k,t._ChatClientLoaderDoNotUseDirectly=M,t.initialize_module=e=>{var t;k.loadChatClientWithBestCampaign(e.url,n.getActiveUserApiV2Properties(),null===(t=e.bypassWaitForTTI)||void 0===t||t)}}));
//# sourceMappingURL=c_chat_chat_client_loader.js-vfl60xNaT.map

//# debugId=d204fb80-83de-3a0b-a4d7-fa16f2380483