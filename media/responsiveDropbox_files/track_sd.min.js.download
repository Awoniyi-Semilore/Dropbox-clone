!function(){"use strict";function t(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e);if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(e,n,o){return n&&function(e,n){for(var o=0;o<n.length;o++){var r=n[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,t(r.key),r)}}(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};window.ktag.bugsnag&&"object"===e(t)&&window.ktag.bugsnag.pushBreadCrumb(t)},r=function(){function t(e){var n,o,r,i=this,a=e.selector,c=e.callback,s=e.privacyMode,l=void 0!==s&&s,d=e.rejectMode,u=void 0!==d&&d;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.privacyMode=l,this.initialized=!1,this.callback=c,this.tracker=function(){},this.node=this.getTrackedNode(a||"body"),this.scrollTimeout=null,this.touchEndListener=function(){return i.onScroll()},this.scrollListener=(n=function(){return i.onScroll()},o=200,function(){var t=this,e=arguments;clearTimeout(r),r=setTimeout((function(){n.apply(t,e)}),o)}),this.keyDownListener=function(t){return i.onKeyDown(t)},this.threshold=0,u||void 0===this.node||null===this.node||this.init()}return n(t,[{key:"init",value:function(){var t=this;o({name:"[ScrollDepth Tracker] initializing tracker"}),this.yPosMax=this.getYPos(),function(t){var e=!1,n=function(){document.addEventListener?(document.removeEventListener("DOMContentLoaded",o),window.removeEventListener("load",o)):(document.detachEvent("onreadystatechange",o),window.detachEvent("onload",o))},o=function(){e||!document.addEventListener&&"load"!==event.type&&"complete"!==document.readyState||(e=!0,n(),t())};if("complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState||document.body)t();else if(document.addEventListener)document.addEventListener("DOMContentLoaded",o),window.addEventListener("load",o);else{document.attachEvent("onreadystatechange",o),window.attachEvent("onload",o);var r=!1;try{r=null==window.frameElement&&document.documentElement}catch(t){}r&&r.doScroll&&function o(){if(!e){try{r.doScroll("left")}catch(t){return setTimeout(o,50)}e=!0,n(),t()}}()}}((function(){t.shouldTrackThreshold(),"ontouchstart"in window||navigator.msMaxTouchPoints||-1!==navigator.userAgent.indexOf("IEMobile")?t.tracker=t.initMobileTracker():t.tracker=t.initStandardTracker(),t.initialized=!0}))}},{key:"initMobileTracker",value:function(){var t=this;try{return document.addEventListener("touchend",this.touchEndListener),function(){document.removeEventListener("touchend",t.touchEndListener)}}catch(t){o({name:"[ScrollDepth Tracker] cannot initialize tracker (mobile)"}),window.ktag.bugsnag.reportError(t)}}},{key:"initStandardTracker",value:function(){var t=this;try{return document.addEventListener("scroll",this.scrollListener),document.addEventListener("keydown",this.keyDownListener),function(){document.removeEventListener("keydown",t.keyDownListener),document.removeEventListener("scroll",t.scrollListener)}}catch(t){o({name:"[ScrollDepth Tracker] cannot initialize tracker"}),window.ktag.bugsnag.reportError(t)}}},{key:"disable",value:function(){o({name:"[ScrollDepth Tracker] disabling tracker"});try{this.tracker(),this.initialized=!1}catch(t){window.ktag.bugsnag.reportError(t)}}},{key:"setPrivacyMode",value:function(t){this.privacyMode=t}},{key:"getTrackedNode",value:function(t){return t?document.querySelector(t)?document.querySelector(t):o({name:"[ScrollDepth Tracker] Node unavailable for scroll depth tracking"}):document.documentElement?document.documentElement:o({name:"[ScrollDepth Tracker] Node unavailable for scroll depth tracking"})}},{key:"onScroll",value:function(){this.hasReachedBottomOfContent()&&this.tracker(),this.shouldTrackThreshold()}},{key:"shouldTrackThreshold",value:function(){var t=this;if(this.yPosMax=this.getYPos(),"number"!=typeof this.yPosMax||isNaN(this.yPosMax)||!this.node)return window.Ktag.bugsnag.reportError(new Error("invalid scrolldepth yPosMax"),{data:{yPosMax:this.yPosMax}});if(this.yPosMax>this.threshold){clearTimeout(this.scrollTimeout);var e=Math.floor(100*this.yPosMax/this.node.scrollHeight);e<1&&(e=1);var n={type:"scroll_depth",scroll_position:this.yPosMax,scroll_pct:e};this.scrollTimeout=setTimeout((function(){return t.callback(n)}),100),this.threshold=this.yPosMax}}},{key:"onKeyDown",value:function(t){var e=(t.code||"").toLowerCase();"space"!==e&&"arrowdown"!==e||this.onScroll()}},{key:"getYPos",value:function(){return window.scrollY+window.innerHeight}},{key:"hasReachedBottomOfContent",value:function(){return!!this.node&&(this.yPosMax&&this.yPosMax>=this.node.scrollHeight)}}]),t}();window.ktag&&(window.ktag.ScrollDepthTracker=r)}();
